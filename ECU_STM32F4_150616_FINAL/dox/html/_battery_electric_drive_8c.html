<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>ss15_BOLTZ_MMI_F4: T:/MYS_Projects/15SS_Team_BOLTZ/ECU-MMI/2 Code/BOLTZ_MMI_FINAL/Work_STM32F4_150616/src/BatteryElectricDrive.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ss15_BOLTZ_MMI_F4
   &#160;<span id="projectnumber">1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_battery_electric_drive_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">BatteryElectricDrive.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Main BatteryElectricDrive module initializes peripherals and uC/OS, generates <a class="el" href="_battery_electric_drive_8c.html#ade2e35dfaab7d11faa8768846611cc4f" title="prototype of startup task">StartUpTask()</a> and all user tasks, ie CANMsgSend(), CANMsgRec(), TerminalOutput(), SDwrite(), LCDOutput().  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &quot;platform_cfg.h&quot;</code><br/>
<code>#include &quot;Peripheral_Init.h&quot;</code><br/>
<code>#include &quot;CanDefs.h&quot;</code><br/>
<code>#include &quot;AdcDefs.h&quot;</code><br/>
<code>#include &quot;LcdDefs.h&quot;</code><br/>
<code>#include &quot;BasicIO.h&quot;</code><br/>
<code>#include &quot;bsp.h&quot;</code><br/>
</div>
<p><a href="_battery_electric_drive_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad13f8dea3a5243219cd2109520fdefe4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad13f8dea3a5243219cd2109520fdefe4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#ad13f8dea3a5243219cd2109520fdefe4">SW_VERSION</a>&#160;&#160;&#160;&quot;V150616&quot;</td></tr>
<tr class="memdesc:ad13f8dea3a5243219cd2109520fdefe4"><td class="mdescLeft">&#160;</td><td class="mdescRight">version number string <br/></td></tr>
<tr class="separator:ad13f8dea3a5243219cd2109520fdefe4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3372070cf3820b5679ff7b0db7ea26f6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3372070cf3820b5679ff7b0db7ea26f6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a3372070cf3820b5679ff7b0db7ea26f6">OS_STATISTICS_ON</a></td></tr>
<tr class="memdesc:a3372070cf3820b5679ff7b0db7ea26f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">conditional compile flag <br/></td></tr>
<tr class="separator:a3372070cf3820b5679ff7b0db7ea26f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1682cdab45b940cb3f31ed7523c91fc7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a1682cdab45b940cb3f31ed7523c91fc7">TASK_STK_SIZE</a>&#160;&#160;&#160;128</td></tr>
<tr class="memdesc:a1682cdab45b940cb3f31ed7523c91fc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt; sprintf(), scanf() Prototype etc  <a href="#a1682cdab45b940cb3f31ed7523c91fc7">More...</a><br/></td></tr>
<tr class="separator:a1682cdab45b940cb3f31ed7523c91fc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1a5b1011baa69070c3fc1b46b8b21d1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab1a5b1011baa69070c3fc1b46b8b21d1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#ab1a5b1011baa69070c3fc1b46b8b21d1">N_TASKS</a>&#160;&#160;&#160;5</td></tr>
<tr class="memdesc:ab1a5b1011baa69070c3fc1b46b8b21d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">number of user/application tasks <br/></td></tr>
<tr class="separator:ab1a5b1011baa69070c3fc1b46b8b21d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4801dc3fd02a82c57547374d35d1df3d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4801dc3fd02a82c57547374d35d1df3d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a4801dc3fd02a82c57547374d35d1df3d">USER_BASEPRIO</a>&#160;&#160;&#160;5</td></tr>
<tr class="memdesc:a4801dc3fd02a82c57547374d35d1df3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">priority of first application task <br/></td></tr>
<tr class="separator:a4801dc3fd02a82c57547374d35d1df3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa22f60144a3d08bbce9ce0825c45c42d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa22f60144a3d08bbce9ce0825c45c42d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#aa22f60144a3d08bbce9ce0825c45c42d">STARTUPTASK_PRIO</a>&#160;&#160;&#160;<a class="el" href="_battery_electric_drive_8c.html#a4801dc3fd02a82c57547374d35d1df3d">USER_BASEPRIO</a>-1</td></tr>
<tr class="memdesc:aa22f60144a3d08bbce9ce0825c45c42d"><td class="mdescLeft">&#160;</td><td class="mdescRight">priority of startup task <br/></td></tr>
<tr class="separator:aa22f60144a3d08bbce9ce0825c45c42d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ade2e35dfaab7d11faa8768846611cc4f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#ade2e35dfaab7d11faa8768846611cc4f">StartUpTask</a> (void *data)</td></tr>
<tr class="memdesc:ade2e35dfaab7d11faa8768846611cc4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">prototype of startup task  <a href="#ade2e35dfaab7d11faa8768846611cc4f">More...</a><br/></td></tr>
<tr class="separator:ade2e35dfaab7d11faa8768846611cc4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a959e7c9ff428edd10b7bb45c95c36914"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a959e7c9ff428edd10b7bb45c95c36914">UserTask_CANMsgSend</a> (void *data)</td></tr>
<tr class="memdesc:a959e7c9ff428edd10b7bb45c95c36914"><td class="mdescLeft">&#160;</td><td class="mdescRight">prototypes of user task for transmitting CAN message  <a href="#a959e7c9ff428edd10b7bb45c95c36914">More...</a><br/></td></tr>
<tr class="separator:a959e7c9ff428edd10b7bb45c95c36914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c9f595ec335fd0ce9e8344e1c1c0e48"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a6c9f595ec335fd0ce9e8344e1c1c0e48">UserTask_CANMsgRec</a> (void *data)</td></tr>
<tr class="memdesc:a6c9f595ec335fd0ce9e8344e1c1c0e48"><td class="mdescLeft">&#160;</td><td class="mdescRight">prototypes of user tasks for reeciving CAN message  <a href="#a6c9f595ec335fd0ce9e8344e1c1c0e48">More...</a><br/></td></tr>
<tr class="separator:a6c9f595ec335fd0ce9e8344e1c1c0e48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adecdc8f97d2c2198a751fcf7ccba2bac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#adecdc8f97d2c2198a751fcf7ccba2bac">UserTask_TerminalOutput</a> (void *data)</td></tr>
<tr class="memdesc:adecdc8f97d2c2198a751fcf7ccba2bac"><td class="mdescLeft">&#160;</td><td class="mdescRight">prototypes of user tasks for displaying the values on the terminal  <a href="#adecdc8f97d2c2198a751fcf7ccba2bac">More...</a><br/></td></tr>
<tr class="separator:adecdc8f97d2c2198a751fcf7ccba2bac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1ee278d4f1b75d84e637b7b812a9bc8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#af1ee278d4f1b75d84e637b7b812a9bc8">UserTask_SDwrite</a> (void *data)</td></tr>
<tr class="memdesc:af1ee278d4f1b75d84e637b7b812a9bc8"><td class="mdescLeft">&#160;</td><td class="mdescRight">prototypes of user task for saving all data on SD drive  <a href="#af1ee278d4f1b75d84e637b7b812a9bc8">More...</a><br/></td></tr>
<tr class="separator:af1ee278d4f1b75d84e637b7b812a9bc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e2cfc33fafdcd099809c9747a72b136"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a2e2cfc33fafdcd099809c9747a72b136">UserTask_LCDOutput</a> (void *data)</td></tr>
<tr class="memdesc:a2e2cfc33fafdcd099809c9747a72b136"><td class="mdescLeft">&#160;</td><td class="mdescRight">prototypes of user tasks for displaying the values on the LCD  <a href="#a2e2cfc33fafdcd099809c9747a72b136">More...</a><br/></td></tr>
<tr class="separator:a2e2cfc33fafdcd099809c9747a72b136"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11cf94b121679249d3befa1db548e76b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a11cf94b121679249d3befa1db548e76b">PrintOSerr</a> (UINT8 uCOSerrNo, char *pFunctionName)</td></tr>
<tr class="memdesc:a11cf94b121679249d3befa1db548e76b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check uc/OS error code and output with name of error causing function to terminal if &lt;&gt; 0.  <a href="#a11cf94b121679249d3befa1db548e76b">More...</a><br/></td></tr>
<tr class="separator:a11cf94b121679249d3befa1db548e76b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17e9789a29a87d2df54f12b94dd1a0b6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a17e9789a29a87d2df54f12b94dd1a0b6">EXTI0_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a17e9789a29a87d2df54f12b94dd1a0b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt handler for user push button.  <a href="#a17e9789a29a87d2df54f12b94dd1a0b6">More...</a><br/></td></tr>
<tr class="separator:a17e9789a29a87d2df54f12b94dd1a0b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="memdesc:a840291bc02cba5474a4cb46a9b9566fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes MCU peripherals, uCOS and creates StartUp Task.  <a href="#a840291bc02cba5474a4cb46a9b9566fe">More...</a><br/></td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac39a3319317b62e9fd6f506cadee5a63"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac39a3319317b62e9fd6f506cadee5a63"></a>
OS_STK&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#ac39a3319317b62e9fd6f506cadee5a63">UserTaskStk</a> [<a class="el" href="_battery_electric_drive_8c.html#ab1a5b1011baa69070c3fc1b46b8b21d1">N_TASKS</a>][<a class="el" href="_battery_electric_drive_8c.html#a1682cdab45b940cb3f31ed7523c91fc7">TASK_STK_SIZE</a>]</td></tr>
<tr class="memdesc:ac39a3319317b62e9fd6f506cadee5a63"><td class="mdescLeft">&#160;</td><td class="mdescRight">user task stacks <br/></td></tr>
<tr class="separator:ac39a3319317b62e9fd6f506cadee5a63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6515361a200b4fb3b8ca5d50efeffde"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac6515361a200b4fb3b8ca5d50efeffde"></a>
OS_STK&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#ac6515361a200b4fb3b8ca5d50efeffde">StartUpTaskStk</a> [<a class="el" href="_battery_electric_drive_8c.html#a1682cdab45b940cb3f31ed7523c91fc7">TASK_STK_SIZE</a>]</td></tr>
<tr class="memdesc:ac6515361a200b4fb3b8ca5d50efeffde"><td class="mdescLeft">&#160;</td><td class="mdescRight">startup task stack <br/></td></tr>
<tr class="separator:ac6515361a200b4fb3b8ca5d50efeffde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a205acc13c34d5fb0ecd2d79dd75897af"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a205acc13c34d5fb0ecd2d79dd75897af"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a205acc13c34d5fb0ecd2d79dd75897af">UserTaskData</a> [<a class="el" href="_battery_electric_drive_8c.html#ab1a5b1011baa69070c3fc1b46b8b21d1">N_TASKS</a>+1]</td></tr>
<tr class="memdesc:a205acc13c34d5fb0ecd2d79dd75897af"><td class="mdescLeft">&#160;</td><td class="mdescRight">parameters for tasks <br/></td></tr>
<tr class="separator:a205acc13c34d5fb0ecd2d79dd75897af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfcdf22d406b896be2e5d2a400194ff2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adfcdf22d406b896be2e5d2a400194ff2"></a>
CanDisplayMotorParams&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#adfcdf22d406b896be2e5d2a400194ff2">MotorParam</a></td></tr>
<tr class="memdesc:adfcdf22d406b896be2e5d2a400194ff2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains Motor Parameters like Current,Voltage, Temperature... <br/></td></tr>
<tr class="separator:adfcdf22d406b896be2e5d2a400194ff2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8306454b9003a64941baea6abcf97fb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad8306454b9003a64941baea6abcf97fb"></a>
CanDisplayBatteryParams&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#ad8306454b9003a64941baea6abcf97fb">BatteryParam</a></td></tr>
<tr class="memdesc:ad8306454b9003a64941baea6abcf97fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">RT-BMS master parameters like Battery Capacity, Temperature, errors... <br/></td></tr>
<tr class="separator:ad8306454b9003a64941baea6abcf97fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b87dcc29e3ffbbebb2e57cf07f0856d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9b87dcc29e3ffbbebb2e57cf07f0856d"></a>
LcdDisplayParams&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a9b87dcc29e3ffbbebb2e57cf07f0856d">LCDParam</a></td></tr>
<tr class="memdesc:a9b87dcc29e3ffbbebb2e57cf07f0856d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Motor and BMS parameters that are to be displayed on the LCD Screen. <br/></td></tr>
<tr class="separator:a9b87dcc29e3ffbbebb2e57cf07f0856d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa589cbfb65df193ec7a66e3fb0a7332a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa589cbfb65df193ec7a66e3fb0a7332a"></a>
UINT16&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#aa589cbfb65df193ec7a66e3fb0a7332a">Potivalue</a></td></tr>
<tr class="memdesc:aa589cbfb65df193ec7a66e3fb0a7332a"><td class="mdescLeft">&#160;</td><td class="mdescRight">raw potentiometer value received from ADC channel 1 <br/></td></tr>
<tr class="separator:aa589cbfb65df193ec7a66e3fb0a7332a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14e943d4e2f522b192a5e577f8d2f0af"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a14e943d4e2f522b192a5e577f8d2f0af"></a>
UINT32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a14e943d4e2f522b192a5e577f8d2f0af">ThrottleCmdNew</a></td></tr>
<tr class="memdesc:a14e943d4e2f522b192a5e577f8d2f0af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Smoothened throttle command value. <br/></td></tr>
<tr class="separator:a14e943d4e2f522b192a5e577f8d2f0af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0834c93f3831159ec09e6ed58f83737b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0834c93f3831159ec09e6ed58f83737b"></a>
UINT8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a0834c93f3831159ec09e6ed58f83737b">ThrottleCmdNew_str</a> [5]</td></tr>
<tr class="memdesc:a0834c93f3831159ec09e6ed58f83737b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array to store the integer to string converted value of throttle. <br/></td></tr>
<tr class="separator:a0834c93f3831159ec09e6ed58f83737b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f47e042c2aca024c6534fdf5c3d9426"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8f47e042c2aca024c6534fdf5c3d9426"></a>
FATFS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a8f47e042c2aca024c6534fdf5c3d9426">FatFs</a></td></tr>
<tr class="memdesc:a8f47e042c2aca024c6534fdf5c3d9426"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fatfs object. <br/></td></tr>
<tr class="separator:a8f47e042c2aca024c6534fdf5c3d9426"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4be63952e3c9cb0f46f9e592b3c78714"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4be63952e3c9cb0f46f9e592b3c78714"></a>
FIL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#a4be63952e3c9cb0f46f9e592b3c78714">fil</a></td></tr>
<tr class="memdesc:a4be63952e3c9cb0f46f9e592b3c78714"><td class="mdescLeft">&#160;</td><td class="mdescRight">File object. <br/></td></tr>
<tr class="separator:a4be63952e3c9cb0f46f9e592b3c78714"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab43d7bcfb87e7ef71138d651ce1bea1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aab43d7bcfb87e7ef71138d651ce1bea1"></a>
FRESULT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_battery_electric_drive_8c.html#aab43d7bcfb87e7ef71138d651ce1bea1">res</a></td></tr>
<tr class="memdesc:aab43d7bcfb87e7ef71138d651ce1bea1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Variable for error handling. <br/></td></tr>
<tr class="separator:aab43d7bcfb87e7ef71138d651ce1bea1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main BatteryElectricDrive module initializes peripherals and uC/OS, generates <a class="el" href="_battery_electric_drive_8c.html#ade2e35dfaab7d11faa8768846611cc4f" title="prototype of startup task">StartUpTask()</a> and all user tasks, ie CANMsgSend(), CANMsgRec(), TerminalOutput(), SDwrite(), LCDOutput(). </p>
<hr/>
<dl class="section author"><dt>Author</dt><dd>B. Mysliwetz </dd></dl>
<dl class="section version"><dt>Version</dt><dd>V2.00 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>16.06.15 The MMI Unit receives HBC25063 motorcontroller and BMS status information via CAN bus and writes the data to a terminal (via USART = for basic debugging/monitoring) as well as to a QVGA LCD (via SPI = operational graphics screen of cockpit instrument). Furthermore it reads the throttle knob/input setting and sends it to the motor controller via CAN bus. The OS scheduler is set to 200 ticks per second. All received &amp; sent values are logged to a file on SDcard (via SPI) every 1s (1 Hz rate). There are two LEDs indications: one indicates the scheduling process of the RTOS by toggling the STATUS_LED whenever "UserTask_CANMsgSend" (task with the highest priority) is executed. A second LED indicates if the user pressed the alert button (as yet to simulate an emergency shut-off signal e.g. to a circuit breaker to disconnect the battery).</dd></dl>
<p>Peripherals settings are done via Periph_Init() in module peripheral_init.c. Hardware configuration parameters are provided in module platform_cfg.h.</p>
<p>Refresh rate for UserTasks</p>
<ul>
<li>StartUpTask - 1s</li>
<li>UserTask_CANMsgSend - 0.1s</li>
<li>UserTask_CANMsgRec - 0.1s</li>
<li>UserTask_LCDOutput - 0.5s</li>
<li>UserTask_SDwrite - 1s</li>
<li>UserTask_TerminalOutput - 1s</li>
</ul>
<p>Main peripherals/interfaces &amp; operational settings:</p>
<ul>
<li>Motor Controller: CAN1, 500 kbps, extended 29-bit IDs</li>
<li>Battery Managements: CAN1, 500 kbps, extended 29-bit IDs</li>
<li>Terminal: USART6, 9600 bps, 8N1, no flowcontrol</li>
<li>SD Card: SPI1, Prescaler 128 (from master clock), STM32F107 is master</li>
<li>LCD: SPI3, CS = PB10, CLK = PC10, MISO = PC11, MOSI = PC12</li>
<li>Throttle ADC1, Port GPIOC Bit#4, channel 14, 12bit resolution, single conversion mode</li>
<li>Alert-Button: USER, Port GPIOB Bit#7, as interrupt EXTI#7</li>
<li>RTOS_STATUS_LED: LED#1, Port GPIOE Bit#8</li>
<li>SIM_SHUT_OFF_LED: LED#3, Port GPIOE Bit#10</li>
<li>SHUT_OFF_PIN: Port GPIOB Bit#8</li>
</ul>
<p>changes: 14.05.14 Sending the throttle value obtained fron Scaled POTI value via CAN bus. 27.05.14 Conditional programming for printing of ADC Values 04.06.16 Structure for Motor parameters. 16.06.14 Change in the incoming packet address 17.06.14 Implementing the excape sequences 18.06.14 Adding the smoothing function for ADC value 25.09.14 Janezic Sommerauer: STM32F4 Discovery file adaptation 08.11.14 Janezic Sommerauer: Emergency shutdown implementation 10.12.14 Janezic Sommerauer: Data logging on SD Card implementation 16.12.14 Janezic Sommerauer: STM32F4 LCD output implementation 11.02.15 Janezic Sommerauer: Additionnal Doxygen compatible descriptions </p>

<p>Definition in file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a1682cdab45b940cb3f31ed7523c91fc7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TASK_STK_SIZE&#160;&#160;&#160;128</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&lt; sprintf(), scanf() Prototype etc </p>
<p>&lt; STM32F4 board specific files (condition) &lt; target selection &amp; abstraction defs &lt; Initialization of all peripherals &lt; CAN related functions ADC related functions LCD related functions useful constants, avoid multiple include files &lt; low level IO, clock &amp; int related defs for uC/OS a task's stack size (in 16-bit WORDs) </p>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00105">105</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a17e9789a29a87d2df54f12b94dd1a0b6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EXTI0_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt handler for user push button. </p>
<p>Exterior hardware interrupt handler for user input push Alert button.</p>
<hr/>
 <dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00585">585</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<a class="anchor" id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes MCU peripherals, uCOS and creates StartUp Task. </p>
<hr/>
 <dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td>: uC/OS applications NEVER return ! </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00158">158</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<a class="anchor" id="a11cf94b121679249d3befa1db548e76b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PrintOSerr </td>
          <td>(</td>
          <td class="paramtype">UINT8&#160;</td>
          <td class="paramname"><em>uCOSerrNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pFunctionName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check uc/OS error code and output with name of error causing function to terminal if &lt;&gt; 0. </p>
<hr/>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uCOSerrNo</td><td>: uC/OS error code </td></tr>
    <tr><td class="paramname">pFunctionName</td><td>: name of function in which error occurred </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00556">556</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<a class="anchor" id="ade2e35dfaab7d11faa8768846611cc4f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void StartUpTask </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prototype of startup task </p>
<p>Initializes uC/OS system timer and creates all user tasks.</p>
<hr/>
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>: pointer to optional input parameter block </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00190">190</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6c9f595ec335fd0ce9e8344e1c1c0e48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UserTask_CANMsgRec </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prototypes of user tasks for reeciving CAN message </p>
<p>The messages that are sent by moto and Battery via CAN bus is received through functions CAN_ReceiveMotorParameters, CAN_ReceiveMotorParameters respectively.</p>
<hr/>
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>: pointer to optional input parameter block </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00358">358</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<a class="anchor" id="a959e7c9ff428edd10b7bb45c95c36914"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UserTask_CANMsgSend </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prototypes of user task for transmitting CAN message </p>
<p>LED is switched On and the smoothened Potentiometer value is sent to function CAN_FillThrottlemsg to send it via CAN bus.</p>
<hr/>
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>: pointer to optional input parameter block </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>&lt; temp new throttle value buffer</p>
<p>&lt; temp old throttle value buffer</p>
<p>&lt; loop index size </p>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00293">293</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2e2cfc33fafdcd099809c9747a72b136"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UserTask_LCDOutput </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prototypes of user tasks for displaying the values on the LCD </p>
<p>Print the received motor and battery parameters and the throttle command value on the LCD.</p>
<hr/>
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>: pointer to optional input parameter block </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00380">380</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<a class="anchor" id="af1ee278d4f1b75d84e637b7b812a9bc8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UserTask_SDwrite </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prototypes of user task for saving all data on SD drive </p>
<p>Write the received motor parameters, battery parameters and the throttle command value on the SD card.</p>
<hr/>
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>: pointer to optional input parameter block </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td>NOTE: See SD folder for more usage details </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00402">402</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
<a class="anchor" id="adecdc8f97d2c2198a751fcf7ccba2bac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void UserTask_TerminalOutput </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prototypes of user tasks for displaying the values on the terminal </p>
<p>Print the received motor and battery parameters and the throttle command value on the screen terminal.</p>
<hr/>
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>: pointer to optional input parameter block </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_battery_electric_drive_8c_source.html#l00460">460</a> of file <a class="el" href="_battery_electric_drive_8c_source.html">BatteryElectricDrive.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_82491d221230571ab1efb405ca4a47fb.html">T:</a></li><li class="navelem"><a class="el" href="dir_7ee8bcfe5058410ad7df6c0e8f6123a8.html">MYS_Projects</a></li><li class="navelem"><a class="el" href="dir_d04f86abea8a4c010c93dab109574321.html">15SS_Team_BOLTZ</a></li><li class="navelem"><a class="el" href="dir_41d18b8d35ca6152ebe9237aca188e22.html">ECU-MMI</a></li><li class="navelem"><a class="el" href="dir_346133093572adf50e3b9c889d235264.html">2 Code</a></li><li class="navelem"><a class="el" href="dir_118fe734d475f3235f7fee485ed04fea.html">BOLTZ_MMI_FINAL</a></li><li class="navelem"><a class="el" href="dir_0e764c3131babe2c73c602fa54c5baf8.html">Work_STM32F4_150616</a></li><li class="navelem"><a class="el" href="dir_72e8b63091ff5e1472e1391b9ba8d153.html">src</a></li><li class="navelem"><a class="el" href="_battery_electric_drive_8c.html">BatteryElectricDrive.c</a></li>
    <li class="footer">Generated on Mon Oct 26 2015 14:13:21 for ss15_BOLTZ_MMI_F4 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
